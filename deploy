#!/bin/bash

if [ $# -lt 1 ]
then
    KUSTOMIZE_DIR="$(pwd)/kustomize/base"
else
    KUSTOMIZE_DIR="$(pwd)/kustomize/overlays/$1"
    if [ ! -d $KUSTOMIZE_DIR ]
    then
        echo "There is no overlay for [$1]" >&2
        exit 1
    fi
fi

echo "generating kustomization yaml dir $KUSTOMIZE_DIR "

kustomize build \
    --enable-helm \
    --load-restrictor LoadRestrictionsNone \
    "${KUSTOMIZE_DIR}" > yaml/demo-astroshop.yaml

echo "applying kustomization"
    
#kubectl apply -f yaml/demo-astroshop.yaml
